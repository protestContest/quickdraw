#include "graphics.h"short graphics__OldMBarHeight;short graphics__FrameInterval = 1;long graphics__FrameCount;char graphics__Buffer[64][342];BitMap graphics__BufferBits;Rect graphics__RedrawRect;void WindowInit() {	Rect totalRect, mBarRect;	RgnHandle mBarRgn;	WindowPtr window;		graphics__OldMBarHeight = MBarHeight;	MBarHeight = 0;		window = NewWindow(nil, &(screenBits.bounds), kEmptyTitle, kVisible,			plainDBox, kMoveToFront,  kNoGoAway, kNilRefCon);	SetRect(&mBarRect, screenBits.bounds.left, screenBits.bounds.top,			screenBits.bounds.right, screenBits.bounds.top + graphics__OldMBarHeight);	mBarRgn = NewRgn();	RectRgn (mBarRgn, &mBarRect);	UnionRgn(window->visRgn, mBarRgn, window->visRgn);	DisposeRgn(mBarRgn);	SetPort(window);		graphics__BufferBits.baseAddr = (Ptr)&graphics__Buffer;	graphics__BufferBits.rowBytes = 64;	graphics__BufferBits.bounds = screenBits.bounds;	FillRect(&(window->portRect), black);	SetPortBits(&graphics__BufferBits);		SetRect(&graphics__RedrawRect, 0, 0, kWidth, kHeight);		FillRect(&(window->portRect), black);}void RestoreMBar() {	MBarHeight = graphics__OldMBarHeight;}void DoVBL(VBLRecPtr VRP) {	graphics__FrameCount++;	FillRect(&graphics__RedrawRect, black);	VRP->draw(TickCount());	CopyBits(&graphics__BufferBits, &screenBits, &graphics__RedrawRect, &graphics__RedrawRect, srcCopy, nil);	VRP->theVBLTask.vblCount = graphics__FrameInterval;}void StartVBL() {	long curA5;	VBLRecPtr recPtr;	recPtr =  GetVBLRec();	curA5 = SetA5(recPtr->VBLA5);	DoVBL(recPtr);	(void) SetA5(curA5);}void InstallVBL(DrawPtr draw, DrawPtr update) {	VBLRec theVBLRec;	OSErr theErr;		graphics__FrameCount = 0;		theVBLRec.VBLA5 = SetCurrentA5();	theVBLRec.draw = draw;	theVBLRec.theVBLTask.vblAddr = (VBLProcPtr) StartVBL;	theVBLRec.theVBLTask.vblCount = graphics__FrameInterval;	theVBLRec.theVBLTask.qType = vType;	theVBLRec.theVBLTask.vblPhase = 0;		theErr = VInstall((QElemPtr)&theVBLRec.theVBLTask);	if (!theErr) {		do {			update(graphics__FrameCount);		} while (!Button());		theErr = VRemove((QElemPtr)&theVBLRec.theVBLTask);	}	FlushEvents(mDownMask, 0);}void SetRedrawRect(Rect *rect) {	SetRect(&graphics__RedrawRect, rect->left, rect->top, rect->right, rect->bottom);}